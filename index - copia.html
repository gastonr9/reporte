<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Actualizar X21</title>
    <style>
      iframe {
        width: 100%;
        height: 100vh;
        border: none;
      }
    </style>
  </head>
  <body>
    <!-- üìä Vista del Google Sheet incrustada -->
    <iframe
      id="sheetFrame"
      src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTlbYlX3y3ym8VeKgl9INPxLa_jEcbmud4d6aQJ9zOEFPU6Mrd3lZcObc-ojsRi8uSPmVxKjH8Nliru/pubhtml?gid=1720136139&single=true&widget=true&headers=false"
    ></iframe>

    <script>
      // üîÑ Funci√≥n para actualizar la celda X21 a "false"
      async function actualizarX21() {
        const valor = false;
        const url =
          "https://script.google.com/macros/s/AKfycby1kZ8ITZVwhsaHuw6hw1u0todLzX4gFAQY762P50refAjJx5lVPUk9nq-Chua6yBOl/exec";
        const params = new URLSearchParams({ valor });

        try {
          const res = await fetch(url, {
            method: "POST",
            body: params,
          });
          const texto = await res.text();
          console.log("‚úÖ X21 actualizado a false:", texto);
        } catch (error) {
          console.error("‚ùå Error al actualizar X21:", error);
        }
      }

      // üîç Verifica si el valor es "true" cada 70 segundos
      async function chequearCambio() {
        try {
          const res = await fetch(
            "https://script.google.com/macros/s/AKfycby1kZ8ITZVwhsaHuw6hw1u0todLzX4gFAQY762P50refAjJx5lVPUk9nq-Chua6yBOl/exec"
          );
          const texto = await res.text();
          const valor = texto.trim().toLowerCase();

          if (valor === "true") {
            console.log("üö® Valor 'true' detectado. Ejecutando acciones...");

            // ‚ùó Refrescar el iframe evitando el cach√©
            const iframe = document.getElementById("sheetFrame");
            iframe.src =
              "https://docs.google.com/spreadsheets/d/e/2PACX-1vTlbYlX3y3ym8VeKgl9INPxLa_jEcbmud4d6aQJ9zOEFPU6Mrd3lZcObc-ojsRi8uSPmVxKjH8Nliru/pubhtml?gid=1720136139&single=true&widget=true&headers=false&t=" +
              new Date().getTime();

            await actualizarX21();
            await window.location.reload(true);
          }
        } catch (error) {
          console.error("‚ùå Error al verificar el estado:", error);
        }
      }

      // ‚è≤Ô∏è Ejecutar chequeo cada 70 segundos
      setInterval(chequearCambio, 10000);
    </script>
  </body>
</html>
